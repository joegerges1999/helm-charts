- hosts: 127.0.0.1
  connection: local
  vars:
    team: "{{ team }}"

  tasks:
  - name: removing ingress rule to stop access to SonarQube
    helm:
        state: present
        name: sonarqube
        chart: 
            name: sonarqube
            source:
                type: directory
                location: ../
        values:
            ingress:
                enabled: false

 # - name: created backups later

  - name: scaling down the service for restart
    helm:
        state: present
        name: sonarqube
        chart: 
            name: sonarqube
            source:
                type: directory
                location: ../
        values:
            replicaCount: 0

    - name: scaling back up
      helm:
        state: present
        name: sonarqube
        chart: 
            name: sonarqube
            source:
                type: directory
                location: ../
        values:
            replicaCount: 1
            ingress:
                enabled: true
            sonarqube:
                image:
                    tag: 8.4.1-community
      

